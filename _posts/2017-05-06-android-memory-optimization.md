---
layout: post
title: "Android 内存优化笔记"
category: android
---

## RAM的定义

- Registers 寄存器

- stack    栈
```
  - 定义一个局部变量的时候，java虚拟机就会在栈中为其分配内存空间，局部变量的基本数据类型和引用存储于栈中，引用的对象实体存储于堆中。因为它们属于方法中的变量，生命周期随方法而结束。
```
- Heap   堆  
```
  - 成员变量全部存储与堆中（包括基本数据类型，引用和引用的对象实体），因为它们属于类，类对象终究是要被new出来使用的。当堆中对象的作用域结束的时候，这部分内存也不会立刻被回收，而是等待系统GC进行回收。
  - 所谓的内存分析，就是分析Heap中的内存状态。
```
- Static Field
```
  - 是指在固定的位置上存放应用程序运行时一直存在的数据，java在内存中专门划分了一个静态存储区域来管理一些特殊的数据变量如静态的数据变量。
```

- Constant Pool

```
# 查看应用内存使用情况
//$package_name：应用包名
//$pid：应用进程ID，可以用PS命令查看
adb shell dumpsys meminfo $package_name or $pid
```

## Android的沙盒机制  

- *继承进程隔离机制与最小权限原则*     
- 不同的应用有不同的UID，不能互相访问资源
- 每一个Android应用程序都在它自己的进程中运行，都拥有一个独立的Dalvik虚拟机实例。Dalvik经过优化，允许在有限的内存中同时高效地运行多个虚拟机的实例，并且每一个Dalvik应用作为一个独立的Linux进程执行
- ART虚拟机

## 最后

- Android内存优化主要是针对堆（Heap）而言的，当堆中对象的作用域结束的时候，这部分内存也不会立刻被回收，而是等待系统GC进行回收。
- Java中造成内存泄漏的根本原因是：堆内存中长生命周期的对象持有短生命周期对象的强/软引用，尽管短生命周期对象已经不再需要，但是因为长生命周期对象持有它的引用而导致不能被回收。